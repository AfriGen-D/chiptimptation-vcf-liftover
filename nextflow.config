/*
========================================================================================
    chiptimptation-vcf-liftover Configuration
========================================================================================
    Default configuration for the chiptimptation-vcf-liftover pipeline
    Author: Mamana Mbiyavanga
    Version: 1.0.0
========================================================================================
*/

params {
    // Required parameters
    input = null
    chain_file = null
    target_fasta = null
    
    // Optional parameters
    source_build = 'hg19'
    target_build = 'hg38'
    chr_mapping = null
    outdir = './results'
    split_by_chr = false
    validate_output = true
    
    // Resource limits
    max_memory = '128.GB'
    max_cpus = 16
    max_time = '240.h'
    
    // Container settings
    singularity_cache_dir = "${HOME}/.singularity"
    scratch_dir = '/tmp'
    
    // Help parameter
    help = false
    
    // Test parameter
    test = false
}

/*
========================================================================================
    PROCESS CONFIGURATION
========================================================================================
*/

process {
    // Global process settings
    errorStrategy = 'retry'
    maxRetries = 2
    
    // Resource requirements by label
    withLabel: 'crossmap' {
        memory = { 8.GB * task.attempt }
        cpus = 2
        time = { 4.h * task.attempt }
        errorStrategy = { task.exitStatus in [143,137,104,134,139] ? 'retry' : 'finish' }
        maxRetries = 3
    }
    
    withLabel: 'vcf_processing' {
        memory = { 16.GB * task.attempt }
        cpus = 4
        time = { 2.h * task.attempt }
        errorStrategy = { task.exitStatus in [143,137,104,134,139] ? 'retry' : 'finish' }
        maxRetries = 3
    }
    
    withLabel: 'imputation' {
        memory = { 12.GB * task.attempt }
        cpus = 2
        time = { 3.h * task.attempt }
        errorStrategy = { task.exitStatus in [143,137,104,134,139] ? 'retry' : 'finish' }
        maxRetries = 3
    }
    
    withLabel: 'general' {
        memory = { 4.GB * task.attempt }
        cpus = 1
        time = { 1.h * task.attempt }
        errorStrategy = { task.exitStatus in [143,137,104,134,139] ? 'retry' : 'finish' }
        maxRetries = 2
    }
}

/*
========================================================================================
    PROFILES
========================================================================================
*/

profiles {
    singularity {
        singularity.enabled = true
        singularity.autoMounts = true
        singularity.cacheDir = "${params.singularity_cache_dir}"
        docker.enabled = false
        includeConfig 'conf/singularity.config'
    }
    
    slurm {
        process.executor = 'slurm'
        process.queue = 'main'
        includeConfig 'conf/slurm.config'
    }
    
    test {
        params.test = true
        includeConfig 'conf/test.config'
    }
    
    docker {
        docker.enabled = true
        singularity.enabled = false
        includeConfig 'conf/docker.config'
    }
    
    base {
        includeConfig 'conf/base.config'
    }
}

/*
========================================================================================
    MANIFEST
========================================================================================
*/

manifest {
    name = 'chiptimptation-vcf-liftover'
    author = 'Mamana Mbiyavanga'
    description = 'Nextflow pipeline for VCF liftover between genome builds'
    version = '1.0.0'
    nextflowVersion = '>=22.04.0'
    homePage = 'https://github.com/mamanambiya/chiptimptation-vcf-liftover'
    mainScript = 'main.nf'
}

/*
========================================================================================
    REPORTING
========================================================================================
*/

timeline {
    enabled = false
    file = "${params.outdir}/pipeline_info/execution_timeline.html"
}

report {
    enabled = false
    file = "${params.outdir}/pipeline_info/execution_report.html"
}

trace {
    enabled = false
    file = "${params.outdir}/pipeline_info/execution_trace.txt"
}

dag {
    enabled = true
    file = "${params.outdir}/pipeline_info/pipeline_dag.svg"
}

/*
========================================================================================
    CLEANUP
========================================================================================
*/

cleanup = false

/*
========================================================================================
    TOWER CONFIGURATION (Optional)
========================================================================================
*/

tower {
    enabled = false
}
